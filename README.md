# MQTTBench - MQTT 压力测试工具

## 关于项目

MQTTBench 是一个基于 Wails 框架开发的 MQTT 压力测试工具，采用 Go 语言和 Vue 3 前端技术构建。该工具支持分布式 MQTT 压力测试，允许用户通过图形界面管理多个从节点（Slave），配置和执行大规模的 MQTT 连接和消息测试。

项目主要特性：
- 分布式架构：支持一个主节点（Master）管理多个从节点（Slave）
- MQTT 压力测试：支持大规模 MQTT 客户端连接和消息发布/订阅测试
- 实时监控：实时显示各从节点的连接状态和测试结果
- 数据持久化：使用 SQLite 数据库存储测试配置和结果
- 跨平台：支持 Windows 和 Linux 平台

## 项目架构

```
mqttbench/
├── cmd/
│   └── slave/          # 从节点（Slave）程序源码
├── frontend/           # 前端 Vue 项目
├── internal/
│   ├── master/         # 主节点（Master）核心逻辑
│   ├── slave/          # 从节点（Slave）核心逻辑
│   ├── db/             # 数据库操作模块
│   ├── models/         # 数据模型定义
│   ├── performance/    # 性能测试模块
│   └── message/        # 消息测试模块
├── data/               # SQLite 数据库文件目录
└── build/              # 编译输出目录
```

## 快速开始

### 环境要求

- Go 1.16 或更高版本
- Node.js 14 或更高版本
- npm 或 yarn 包管理器

### 安装依赖

```bash
# 安装前端依赖
cd frontend
npm install
cd ..

# 安装 Go 依赖
go mod tidy
```

### 开发模式

#### 启动主程序（Master）

```bash
# 启动开发模式
wails dev
```

这将在开发模式下启动主程序，提供图形界面用于管理从节点和执行测试。

#### 构建从节点（Slave）

```bash
# 构建 Windows 从节点
make build

# 构建 Linux 从节点
make linux

# 构建当前平台从节点
make native
```

### 生产构建

#### 构建主程序

```bash
# 构建生产版本
wails build
```

构建后的可执行文件将位于 `build/bin/` 目录中。

#### 构建从节点

```bash
# 构建从节点
make build
```

## 使用说明

### 启动主节点

1. 运行 `wails dev` 或 `wails build` 后执行生成的可执行文件
2. 主节点将启动 Web 界面，默认监听端口 34115
3. 打开浏览器访问 `http://localhost:34115`

### 启动从节点

1. 在不同的机器或终端中运行构建好的从节点程序
2. 从节点会自动注册到主节点
3. 从节点默认监听随机端口用于接收主节点指令

### 配置测试

1. 在 Web 界面中添加从节点配置
2. 设置 MQTT 服务器地址、主题、QoS 等参数
3. 部署配置到指定从节点
4. 启动或停止测试

## 项目特点

### 分布式测试架构

- 主节点负责管理和协调所有从节点
- 从节点负责实际的 MQTT 连接和消息处理
- 支持动态添加和移除从节点

### MQTT 功能支持

- 支持 MQTT 3.1.1 协议
- 支持多种 QoS 级别（0, 1, 2）
- 支持自定义客户端 ID 和主题
- 支持 ACK 消息确认机制

### 监控和管理

- 实时显示从节点状态（在线/离线/运行中）
- 显示连接数和测试结果统计
- 支持手动启动和停止测试
- 提供详细的日志信息

### 数据持久化

- 使用 SQLite 数据库存储从节点配置
- 记录测试历史和结果
- 支持配置的导入和导出

## 故障排除

### 常见问题

1. **从节点无法注册到主节点**
   - 检查网络连接和防火墙设置
   - 确认主节点 IP 地址和端口配置正确
   - 查看从节点和主节点的日志信息

2. **MQTT 连接失败**
   - 检查 MQTT 服务器地址和端口
   - 确认客户端认证信息正确
   - 查看从节点日志中的错误信息

3. **数据库连接问题**
   - 确保 `data` 目录具有写权限
   - 检查磁盘空间是否充足
   - 查看主节点启动日志中的数据库信息

### 日志查看

- 主节点日志：在终端中查看 `wails dev` 输出
- 从节点日志：在从节点运行的终端中查看输出
- 浏览器控制台：按 F12 打开开发者工具查看前端日志

## 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目。

## 许可证

本项目采用 MIT 许可证。详细信息请查看 LICENSE 文件。